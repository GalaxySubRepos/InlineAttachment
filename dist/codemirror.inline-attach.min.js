/*! inline-attach - v0.1.0 - 2012-12-30 */
(function(e,t){function n(){var e={};for(var t=arguments.length-1;t>=0;t--){var n=arguments[t];for(var r in n)e[r]=n[r]}return e}t.inlineAttach=function(e){var t=n(e,inlineAttach.defaults),r=this;this.uploadFile=function(e){var n=new FormData,r=new XMLHttpRequest;n.append("file",e),r.open("POST",t.upload_url),r.upload.onprogress=function(e){},r.onload=function(e){if(r.status===200){var n=JSON.parse(r.responseText);t.onUploadedFile(n)}},r.send(n)},this.isAllowedFile=function(e){return t.allowed_types.indexOf(e.type)>=0},this.onPaste=function(e){var n=!1,i=e.clipboardData;for(var s=0;s<i.items.length;s++){var o=i.items[s];r.isAllowedFile(o)&&(n=!0,t.onRecievedFile(o.getAsFile()),this.uploadFile(o.getAsFile()))}return n},this.onDrop=function(e){var n=!1;for(var i=0;i<e.dataTransfer.files.length;i++){var s=e.dataTransfer.files[i];r.isAllowedFile(s)&&(n=!0,r.uploadFile(s),t.onRecievedFile(s))}return n}},t.inlineAttach.defaults={upload_url:"upload_attachment.php",allowed_types:["image/jpeg","image/png","image/jpg","image/gif"],onRecievedFile:function(e){},onUploadedFile:function(e){}},t.inlineAttach.attachToInput=function(e,t){}})(document,window),function(e,t){function n(){var e={};for(var t=arguments.length-1;t>=0;t--){var n=arguments[t];for(var r in n)e[r]=n[r]}return e}t.inlineAttach=function(e){var t=n(e,inlineAttach.defaults),r=this;this.uploadFile=function(e){var n=new FormData,r=new XMLHttpRequest;n.append("file",e),r.open("POST",t.upload_url),r.upload.onprogress=function(e){},r.onload=function(e){if(r.status===200){var n=JSON.parse(r.responseText);t.onUploadedFile(n)}},r.send(n)},this.isAllowedFile=function(e){return t.allowed_types.indexOf(e.type)>=0},this.onPaste=function(e){var n=!1,i=e.clipboardData;for(var s=0;s<i.items.length;s++){var o=i.items[s];r.isAllowedFile(o)&&(n=!0,t.onRecievedFile(o.getAsFile()),this.uploadFile(o.getAsFile()))}return n},this.onDrop=function(e){var n=!1;for(var i=0;i<e.dataTransfer.files.length;i++){var s=e.dataTransfer.files[i];r.isAllowedFile(s)&&(n=!0,r.uploadFile(s),t.onRecievedFile(s))}return n}},t.inlineAttach.defaults={upload_url:"upload_attachment.php",allowed_types:["image/jpeg","image/png","image/jpg","image/gif"],onRecievedFile:function(e){},onUploadedFile:function(e){}},t.inlineAttach.attachToInput=function(e,t){}}(document,window),function(e,t){t.inlineAttach.attachToCodeMirror=function(e,t){if(!e.getWrapperElement)throw"Invalid CodeMirror object given";t=t||{},t.onRecievedFile=function(){i="[Upload file...]",e.replaceRange(i,e.getCursor())},t.onUploadedFile=function(t){if(t.filename){var n=e.getCursor();e.setValue(e.getValue().replace(i,"![file]("+t.filename+")")),e.setCursor(n)}};var n=e.getWrapperElement(),r=new inlineAttach(t),i;n.addEventListener("paste",function(e){r.onPaste(e)},!1),e.setOption("onDragEvent",function(e,t){return t.stopPropagation(),t.preventDefault(),r.onDrop(t)})}}(document,window);