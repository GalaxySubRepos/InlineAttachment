/*! inline-attach - v0.1.0 - 2012-12-30 */
(function(e,t){function n(){var e={};for(var t=arguments.length-1;t>=0;t--){var n=arguments[t];for(var r in n)e[r]=n[r]}return e}t.inlineAttach=function(e){var t=n(e,inlineAttach.defaults),r=this;this.uploadFile=function(e){var n=new FormData,r=new XMLHttpRequest;n.append("file",e),r.open("POST",t.upload_url),r.upload.onprogress=function(e){},r.onload=function(e){if(r.status===200){var n=JSON.parse(r.responseText);t.onUploadedFile(n)}},r.send(n)},this.isAllowedFile=function(e){return t.allowed_types.indexOf(e.type)>=0},this.onPaste=function(e){var n=!1,i=e.clipboardData;for(var s=0;s<i.items.length;s++){var o=i.items[s];r.isAllowedFile(o)&&(n=!0,t.onRecievedFile(o.getAsFile()),this.uploadFile(o.getAsFile()))}return n},this.onDrop=function(e){var n=!1;for(var i=0;i<e.dataTransfer.files.length;i++){var s=e.dataTransfer.files[i];r.isAllowedFile(s)&&(n=!0,r.uploadFile(s),t.onRecievedFile(s))}return n}},t.inlineAttach.defaults={upload_url:"upload_attachment.php",allowed_types:["image/jpeg","image/png","image/jpg","image/gif"],onRecievedFile:function(e){},onUploadedFile:function(e){}},t.inlineAttach.attachToInput=function(e,t){t=t||{},t.onRecievedFile=function(t){r="![Uploadf file...]()",e.value=e.value+"\n\n"+r},t.onUploadedFile=function(t){if(t.filename){var n=e.value.replace(r,"![file]("+t.filename+")");e.value=n}};var n=new inlineAttach(t),r;e.addEventListener("paste",function(e){n.onPaste(e)},!1),e.addEventListener("drop",function(e){e.stopPropagation(),e.preventDefault(),n.onDrop(e)},!1),e.addEventListener("dragenter",function(e){e.stopPropagation(),e.preventDefault()},!1),e.addEventListener("dragover",function(e){e.stopPropagation(),e.preventDefault()},!1)}})(document,window),function(e){function t(t){var n=new FileReader;n.onload=function(t){var n=new Image;e("body").append(e("<img/>",{src:t.target.result,width:100}))},n.readAsDataURL(t)}e.fn.inlineattach=function(t){var n=e(this);return n.each(function(){var n=e(this);t.onRecievedFile=function(e){i="![Uploadf file...]()",n.val(n.val()+"\n\n"+i)},t.onUploadedFile=function(e){if(e.filename){var t=n.val().replace(i,"![file]("+e.filename+")");n.val(t)}};var r=new inlineAttach(t),i;n.bind({paste:function(e){r.onPaste(e.originalEvent)},drop:function(e){e.stopPropagation(),e.preventDefault(),r.onDrop(e.originalEvent)},"dragenter dragover":function(e){e.stopPropagation(),e.preventDefault()}})}),this}}(jQuery);